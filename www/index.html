<!DOCTYPE html>
<html>
<head>
	<meta charset=utf-8>
	<title>Recyclr</title>
	<meta name=description content="good kids recycle">
	<meta name=viewport content="width=device-width,initial-scale=1">

	<link rel=stylesheet href=bootstrap.css>
	<style>
html,body,#container,#container>div{height:815px;}
body{overflow:hidden;background:lightskyblue;font-size:18px;}
#container>div{display:none;text-align:center;overflow:hidden;}
#container #loading{display:block;}
#loading .loading{font-size:30px;color:rgba(0,0,0,0.5);margin-top:340px;}
#title{position:relative;z-index:5;margin-top:280px;font-size:60px;font-weight:700;}
#earth{width:100%;position:absolute;top:0;bottom:0;left:0;right:0;background-size:cover;}
#play{position:relative;z-index:5;margin-top:50px;padding-left:30px;padding-right:30px;font-size:28px;}
#info{position:absolute;bottom:18px;left:20px;top:auto;font-size:24px;}
#cali{position:absolute;bottom:18px;left:60px;top:auto;font-size:24px;}
#garbage{width:50px;height:50px;border-radius:25px;background:red;margin-left:auto;margin-right:auto;}
#instruct1,#instruct2{margin-top:320px;font-size:45px;line-height:70px;color:#555;width:800px;margin-left:auto;margin-right:auto;}
a.back{position:absolute;bottom:18px;left:20px;}
	</style>
</head>
<body>
	<div id=container>
	
		<!-- these are the various "pages" -->
		<div id=loading>
			<div class=loading>Loading...</div>
		</div>
		
		<div id=home>
			<h1 id=title>Recyclr</h1>
			<div id=earth></div>
			<a href=# class="btn btn-lg btn-warning" id=play>Play!</a>
			<a href=# class="glyphicon glyphicon-info-sign" id=info title=About data-toggle=modal data-target=#about></a>
			<a href=# class="glyphicon glyphicon-screenshot" id=cali title=Calibrate></a>
			
			<div class="modal fade" id=about>
			  <div class="modal-dialog">
				<div class="modal-content">
				  <div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					<h4 class="modal-title">About Recyclr</h4>
				  </div>
				  <div class="modal-body">
					<p>we're cool</p>
				  </div>
				  <div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				  </div>
				</div><!-- /.modal-content -->
			  </div><!-- /.modal-dialog -->
			</div>
		</div>
		
		<div id=game>
			<div style="width:960px;margin-left:auto;margin-right:auto;margin-top:100px;overflow:hidden;margin-bottom:300px;position:relative;" id=cans>
				<iframe src="3DCans.html" style="width:960px;border:none;height:300px;position:absolute;top:0;left:0;background:rgba(135,206,250,0.5);"></iframe>
				<div style="height:300px;width:210px;background:grey;margin-right:40px;float:left;"></div>
				<div style="height:300px;width:210px;background:blue;margin-right:40px;float:left;"></div>
				<div style="height:300px;width:210px;background:green;margin-right:40px;float:left;"></div>
				<div style="height:300px;width:210px;background:black;float:left;"></div>
			</div>
			<div id=garbage></div>
			<a href=# class="btn btn-primary back">Back</a>
		</div>
		
		<div id=calibrate>
			<div id=instruct1>Put on the Myo and pretend to throw something 45&deg; to the <b>left</b>.</div>
			<div id=instruct2 style="display:none">Now pretend to throw something 45&deg; to the <b>right</b>.</div>
			<a href=# class="btn btn-primary back">Back</a>
		</div>
		
		<div id=end>
		
		</div>
		
		<div id=score>
		
		</div>
	</div>


	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script>window.jQuery||document.write('<script src="jquery.js"><\/script>');</script>
	<script src="includes.js"></script>

	<script src='myo.js'></script>
	<script>
	var myo = Myo.create();
	
	// throw_cons holds all recent data.y values considered part of
	// a "throw"
	// throw_thresh is the threshold value of throw_cons for a throw
	// avoid_karate is the sensitivity of avoiding sideways karate chops as throws
	// throw_strength is the minimum strength of a throw
	var throw_cons = [];
	var throw_thresh = 3;
	var throw_strength = 300;
	
	// sens represents the sensitivity of a throw
	var sens = 250;
	
	// angle is the z-orientation at the most recent frame.
	var angle = 0;
	
	// left and right are the two extreme angles allowed
	var left = 0;
	var right = 0;
	var left_cal = false, right_cal = false;
	
	var score = 0;
	
	myo.on('gyroscope', function(data){
		console.log(angle);
		if(throw_cons.length == throw_thresh
		&& throw_cons[throw_cons.length - 1] > throw_strength) {
			throw_cons = [];
			// console.log(angle);
			if(angle < right && angle > left) {
				var t = swish(angle);
				$(document).trigger('throw', {bin: t});
				// console.log(swish(angle));
			} else if(!left_cal || !right_cal) {
				swish(angle);
			}
		} else if(Math.abs(data.y) > sens) {
			throw_cons.push(data.y);
		} else {
			throw_cons = [];
		}
	});
	
	myo.on('orientation', function(data) {
		angle = data.z;
	});
	
	function swish(angle) {
		var variance = (right - left)/4;
		if(!left_cal) {
			// myo.zeroOrientation();
			left = angle;
			left_cal = true;
			$(document).trigger('calibrated_left');
		} else if (!right_cal) {
			if(left < right) {
				right = angle;
			} else {
				right = left;
				left = angle;
			}
			right_cal = true;
			$(document).trigger('calibrated_right');
		}
		console.log(angle);
		if(angle < left + variance) {
			return 4;
		} else if(angle < left + 2 * variance) {
			return 3;
		} else if(angle < left + 3 * variance) {
			return 2;
		} else {
			return 1;
		}
	}
	$(document).on('calibrate', function() {
		// myo.zeroOrientation();
		left_cal = false;
		right_cal = false;
	});
	</script>
	
	<script>
$(document).ready(function(){
	
	setTimeout(function(){
		$('#loading').fadeOut(400,function(){
			$('#home').fadeIn(400);
		});
	},10);
	
	$('#info').click(function(e){
		e.preventDefault();
		$('#about').css({position:'absolute',top:-1000}).animate({top:0});
	});
	
	$('#play').click(function(e){
		e.preventDefault();
		$('#home').slideUp(400,function(){
			$('#game').fadeIn(400);
		});
	});
	
	$('a.back').click(function(e){
		e.preventDefault();
		$('#container>*:visible').fadeOut(400,function(){
			$('#home').fadeIn(400);
		});
	});
	
	$('#cali').click(function(e){
		e.preventDefault();
		$('#instruct1').hide();
		$('#instruct2').show();
		$('#home').slideUp(400,function(){
			$('#calibrate').fadeIn(400,function(){
				$(document).trigger('calibrate');
				$(document).one('calibrated_left',function(){
					$('#instruct1').hide();
					$('#instruct2').show();
					$(document).one('calibrated_right',function(){
						alert('Successfully calibrated!');
						$('#calibrate').fadeOut(400,function(){
							$('#home').slideDown(400);
						});
					});
				});
			});
		});
	});

	
	var easing={
		top:"easeOutBack",
		left:"linear"
	};
	var throwing=false;
	$(document).on('throw',function(e2,e){
		if(throwing)return;
		if($('#game').css('display')=='none')return;
		
		if(e.bin<=0){
			alert('You need to calibrate your Myo first.');
			return;
		}
		if(e.bin==1){
			score += 1;
			throwing=true;
			setTimeout(function(){
				$('#garbage').css('z-index',-2);
			},620);
			$('#garbage').css({top:$('#garbage').offset().top,position:'absolute',left:$('#garbage').offset().left}).animate({top:$('#cans>div:nth-child(1)').offset().top,left:$('#cans>div:nth-child(1)').offset().left+$('#cans>div:nth-child(1)').width()/2-$('#garbage').width()/4,width:$('#garbage').width()/2,height:$('#garbage').height()/2},{duration:800,queue:false,
			complete:function(){
				$('#garbage').attr('style','');
				throwing=false;
			},
			specialEasing:easing});
		}else if(e.bin==2){
			throwing=true;
			setTimeout(function(){
				$('#garbage').css('z-index',-2);
			},620);
			$('#garbage').css({top:$('#garbage').offset().top,position:'absolute',left:$('#garbage').offset().left}).animate({top:$('#cans>div:nth-child(2)').offset().top,left:$('#cans>div:nth-child(2)').offset().left+$('#cans>div:nth-child(2)').width()/2-$('#garbage').width()/4,width:$('#garbage').width()/2,height:$('#garbage').height()/2},{duration:800,queue:false,
			complete:function(){
				$('#garbage').attr('style','');
				throwing=false;
			},
			specialEasing:easing});
		}else if(e.bin==3){
			throwing=true;
			setTimeout(function(){
				$('#garbage').css('z-index',-2);
			},620);
			$('#garbage').css({top:$('#garbage').offset().top,position:'absolute',left:$('#garbage').offset().left}).animate({top:$('#cans>div:nth-child(3)').offset().top,left:$('#cans>div:nth-child(3)').offset().left+$('#cans>div:nth-child(3)').width()/2-$('#garbage').width()/4,width:$('#garbage').width()/2,height:$('#garbage').height()/2},{duration:800,queue:false,
			complete:function(){
				$('#garbage').attr('style','');
				throwing=false;
			},
			specialEasing:easing});
		}else if(e.bin==4){
			throwing=true;
			setTimeout(function(){
				$('#garbage').css('z-index',-2);
			},620);
			$('#garbage').css({top:$('#garbage').offset().top,position:'absolute',left:$('#garbage').offset().left}).animate({top:$('#cans>div:nth-child(4)').offset().top,left:$('#cans>div:nth-child(4)').offset().left+$('#cans>div:nth-child(4)').width()/2-$('#garbage').width()/4,width:$('#garbage').width()/2,height:$('#garbage').height()/2},{duration:800,queue:false,
			complete:function(){
				$('#garbage').attr('style','');
				throwing=false;
			},
			specialEasing:easing});
		}
		
	});
	$(document).keypress(function(e){
		if(throwing)
			return;
		if($('#game').css('display')!='none'){
			if(e.which==49){
				throwing=true;
				setTimeout(function(){
					$('#garbage').css('z-index',-2);
				},620);
				$('#garbage').css({top:$('#garbage').offset().top,position:'absolute',left:$('#garbage').offset().left}).animate({top:$('#cans>div:nth-child(1)').offset().top,left:$('#cans>div:nth-child(1)').offset().left+$('#cans>div:nth-child(1)').width()/2-$('#garbage').width()/4,width:$('#garbage').width()/2,height:$('#garbage').height()/2},{duration:800,queue:false,
				complete:function(){
					$('#garbage').attr('style','');
					throwing=false;
				},
				specialEasing:easing});
			}else if(e.which==50){
				throwing=true;
				setTimeout(function(){
					$('#garbage').css('z-index',-2);
				},620);
				$('#garbage').css({top:$('#garbage').offset().top,position:'absolute',left:$('#garbage').offset().left}).animate({top:$('#cans>div:nth-child(2)').offset().top,left:$('#cans>div:nth-child(2)').offset().left+$('#cans>div:nth-child(2)').width()/2-$('#garbage').width()/4,width:$('#garbage').width()/2,height:$('#garbage').height()/2},{duration:800,queue:false,
				complete:function(){
					$('#garbage').attr('style','');
					throwing=false;
				},
				specialEasing:easing});
			}else if(e.which==51){
				throwing=true;
				setTimeout(function(){
					$('#garbage').css('z-index',-2);
				},620);
				$('#garbage').css({top:$('#garbage').offset().top,position:'absolute',left:$('#garbage').offset().left}).animate({top:$('#cans>div:nth-child(3)').offset().top,left:$('#cans>div:nth-child(3)').offset().left+$('#cans>div:nth-child(3)').width()/2-$('#garbage').width()/4,width:$('#garbage').width()/2,height:$('#garbage').height()/2},{duration:800,queue:false,
				complete:function(){
					$('#garbage').attr('style','');
					throwing=false;
				},
				specialEasing:easing});
			}else if(e.which==52){
				throwing=true;
				setTimeout(function(){
					$('#garbage').css('z-index',-2);
				},620);
				$('#garbage').css({top:$('#garbage').offset().top,position:'absolute',left:$('#garbage').offset().left}).animate({top:$('#cans>div:nth-child(4)').offset().top,left:$('#cans>div:nth-child(4)').offset().left+$('#cans>div:nth-child(4)').width()/2-$('#garbage').width()/4,width:$('#garbage').width()/2,height:$('#garbage').height()/2},{duration:800,queue:false,
				complete:function(){
					$('#garbage').attr('style','');
					throwing=false;
				},
				specialEasing:easing});
			}
		}
	});
});
	</script>
</body>
</html>


